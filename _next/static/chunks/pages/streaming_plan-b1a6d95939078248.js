(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[47],{64248:function(t,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/streaming_plan",function(){return n(81245)}])},52783:function(t,r,n){"use strict";n.d(r,{Z:function(){return c}});var e=n(47568),a=n(34051),o=n.n(a),i=n(66479),l=n(67294);function c(t){var r=(0,l.useState)(),n=r[0],a=r[1],c=(0,i.pm)();return(0,l.useEffect)((function(){var r=function(){var r=(0,e.Z)(o().mark((function r(){var n;return o().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t();case 3:n=r.sent,a(n),r.next=11;break;case 7:r.prev=7,r.t0=r.catch(0),c({title:"Error Occurred",description:r.t0.toString(),status:"error",duration:5e3,isClosable:!0}),console.error(r.t0);case 11:case"end":return r.stop()}}),r,null,[[0,7]])})));return function(){return r.apply(this,arguments)}}();r()}),[c,t]),{response:n}}},81245:function(t,r,n){"use strict";n.r(r),n.d(r,{default:function(){return Y}});var e=n(85893),a=n(66479),o=n(40639),i=n(83234),l=n(20979),c=n(57026),u=n(47741),s=n(79855),d=n(97098),f=n(96486),h=n(9008),v=n.n(h),p=n(11163),x=n(67294),g=n(53812);function m(t){var r=t.mvDependency,n=t.svgWidth,a=t.selectedId,o=t.onSelectedIdChange,i=(0,x.useRef)(),l=(0,x.useState)("0px"),c=l[0],u=l[1],h=(0,x.useCallback)((function(){var t=(0,d.zx)().nodeSize([10,34,5]),n=(0,f.cloneDeep)(r),e=t(n);return{width:e.width,height:e.height,dag:n}}),[r]),v=h();return(0,x.useEffect)((function(){v.width;var t=v.height,r=v.dag,e=i.current,l=s.Ys(e),c=s.ak_,d=s.jvg().curve(c).x((function(t){return t.x+10})).y((function(t){return t.y})),f=function(t){return t.data.id===a},h=l.select(".edges").selectAll(".edge").data(r.links()),p=function(t){return t.attr("d",(function(t){var r=t.points;return d(r)})).attr("fill","none").attr("stroke-width",(function(t){return f(t.source)||f(t.target)?2:1})).attr("stroke",(function(t){return f(t.source)||f(t.target)?g.rS.colors.teal[500]:g.rS.colors.gray[300]}))};h.exit().remove(),h.enter().call((function(t){return t.append("path").attr("class","edge").call(p)})),h.call(p);var x=l.select(".nodes").selectAll(".node").data(r.descendants()),m=function(t){return t.attr("transform",(function(t){var r=t.x,n=t.y;return"translate(".concat(r+10,", ").concat(n,")")})).attr("fill",(function(t){return f(t)?g.rS.colors.teal[500]:g.rS.colors.gray[500]}))};x.exit().remove(),x.enter().call((function(t){return t.append("circle").attr("class","node").attr("r",5).call(m)})),x.call(m);var y=l.select(".labels").selectAll(".label").data(r.descendants()),w=function(t){return t.text((function(t){return t.data.name})).attr("x",n-10).attr("font-family","inherit").attr("text-anchor","end").attr("alignment-baseline","middle").attr("y",(function(t){return t.y})).attr("fill",(function(t){return f(t)?g.rS.colors.black[500]:g.rS.colors.gray[500]})).attr("font-weight","600")};y.exit().remove(),y.enter().call((function(t){return t.append("text").attr("class","label").call(w)})),y.call(w);var j=l.select(".overlays").selectAll(".overlay").data(r.descendants()),I=function(t){return t.attr("x",3).attr("height",24).attr("width",n-6).attr("y",(function(t){return t.y-5-12+2+3})).attr("rx",5).attr("fill",g.rS.colors.gray[500]).attr("opacity",0).style("cursor","pointer")};j.exit().remove(),j.enter().call((function(t){return t.append("rect").attr("class","overlay").call(I).on("mouseover",(function(t,r){s.Ys(this).transition().duration(parseInt(g.rS.transition.duration.normal)).attr("opacity",".10")})).on("mouseout",(function(t,r){s.Ys(this).transition().duration(parseInt(g.rS.transition.duration.normal)).attr("opacity","0")})).on("mousedown",(function(t,r){s.Ys(this).transition().duration(parseInt(g.rS.transition.duration.normal)).attr("opacity",".20")})).on("mouseup",(function(t,r){s.Ys(this).transition().duration(parseInt(g.rS.transition.duration.normal)).attr("opacity",".10")})).on("click",(function(t,r){o&&o(r.data.id)}))})),j.call(I),u("".concat(t,"px"))}),[r,a,n,o,v]),(0,e.jsxs)("svg",{ref:i,width:"".concat(n,"px"),height:c,children:[(0,e.jsx)("g",{className:"edges"}),(0,e.jsx)("g",{className:"nodes"}),(0,e.jsx)("g",{className:"labels"}),(0,e.jsx)("g",{className:"overlays"})]})}var y=n(41799),w=n(99534),j=n(828),I=n(39653),b=n(50471),k=n(63679),S=n(14293),C=(0,k.ZP)((function(){return n.e(171).then(n.t.bind(n,55171,23))}));function D(t,r){var n=r.dx,e=r.dy,a=s.G_s().nodeSize([e,n])(t);return a.each((function(t){var r;return r=[t.y,t.x],t.x=r[0],t.y=r[1],r})),a.each((function(t){return t.x=-t.x})),a}function _(t,r){var n=r.margin,e=n.top,a=n.bottom,o=n.left,i=n.right,l=1/0,c=-l,u=1/0,s=-u;return t.each((function(t){return c=t.x>c?t.x:c})),t.each((function(t){return l=t.x<l?t.x:l})),t.each((function(t){return s=t.y>s?t.y:s})),t.each((function(t){return u=t.y<u?t.y:u})),l-=o,c+=i,u-=e,s+=a,t.each((function(t){return t.x=t.x-l})),t.each((function(t){return t.y=t.y-u})),{width:c-l,height:s-u}}var N=12,A=N,z=N;function E(t){var r=t.planNodeDependencies,n=t.fragmentDependency,a=t.selectedFragmentId,o=(0,x.useRef)(),i=(0,I.qY)(),l=i.isOpen,c=i.onOpen,d=i.onClose,h=(0,x.useState)(),v=h[0],p=h[1],m=(0,x.useCallback)((function(){return function(t){p(t.data),c()}}),[c])(),k=(0,x.useCallback)((function(){var t=(0,f.cloneDeep)(r),e=(0,f.cloneDeep)(n),a=new Map,o=!0,i=!1,l=void 0;try{for(var c,u=t[Symbol.iterator]();!(o=(c=u.next()).done);o=!0){var s,d=(0,j.Z)(c.value,2),h=d[0],v=d[1],p=D(v,{dx:72,dy:48}),x=_(p,{margin:{left:60,right:60,top:48,bottom:60}}),g=x.width,m=x.height;a.set(h,{layoutRoot:p,width:g,height:m,extraInfo:null!==(s=v.data.extraInfo)&&void 0!==s?s:""})}}catch(P){i=!0,l=P}finally{try{o||null==u.return||u.return()}finally{if(i)throw l}}var I=(0,S.bK)(e.map((function(t){t.width,t.height;var r=t.id,n=(0,w.Z)(t,["width","height","id"]),e=a.get(r),o=e.width,i=e.height;return(0,y.Z)({width:o,height:i,id:r},n)})),60,60),b=new Map;I.forEach((function(t){var r=t.id,n=t.x,e=t.y;b.set(r,{x:n,y:e})}));var k=[],C=!0,N=!1,A=void 0;try{for(var z,E=a[Symbol.iterator]();!(C=(z=E.next()).done);C=!0){var Z=(0,j.Z)(z.value,2),F=Z[0],q=Z[1],R=b.get(F),Y=R.x,G=R.y;k.push((0,y.Z)({id:F,x:Y,y:G},q))}}catch(P){N=!0,A=P}finally{try{C||null==E.return||E.return()}finally{if(N)throw A}}var L=0,M=0;k.forEach((function(t){var r=t.x,n=t.y,e=t.width,a=t.height;M=Math.max(M,n+a+50),L=Math.max(L,r+e)}));var O=(0,S.o)(I);return{layoutResult:k,fragmentLayout:I,svgWidth:L,svgHeight:M,links:O}}),[r,n]),E=k(),Z=E.svgWidth,F=E.svgHeight,q=E.links,R=(E.fragmentLayout,E.layoutResult);return(0,x.useEffect)((function(){if(R){var t=o.current,r=s.Ys(t),n=s.h5h().x((function(t){return t.x})).y((function(t){return t.y})),e=function(t){return t===a},i=function(t){t.attr("transform",(function(t){var r=t.x,n=t.y;return"translate(".concat(r,", ").concat(n,")")}));var r=t.select(".actor-text-frag-id");r.empty()&&(r=t.append("text").attr("class","actor-text-frag-id")),r.attr("fill","black").text((function(t){var r=t.id;return"Fragment #".concat(r)})).attr("font-family","inherit").attr("text-anchor","end").attr("dy",(function(t){return t.height-z+12})).attr("dx",(function(t){return t.width-A})).attr("fill","black").attr("font-size",12);var a=t.select(".actor-text-actor-id");a.empty()&&(a=t.append("text").attr("class","actor-text-actor-id")),a.attr("fill","black").text((function(t){return t.extraInfo})).attr("font-family","inherit").attr("text-anchor","end").attr("dy",(function(t){return t.height-z+24})).attr("dx",(function(t){return t.width-A})).attr("fill","black").attr("font-size",12);var o=t.select(".bounding-box");o.empty()&&(o=t.append("rect").attr("class","bounding-box")),o.attr("width",(function(t){return t.width-24})).attr("height",(function(t){return t.height-24})).attr("x",A).attr("y",z).attr("fill","white").attr("stroke-width",(function(t){var r=t.id;return e(r)?3:1})).attr("rx",5).attr("stroke",(function(t){var r=t.id;return e(r)?g.rS.colors.teal[500]:g.rS.colors.gray[500]}));var i=t.select(".links");i.empty()&&(i=t.append("g").attr("class","links"));var l=function(t){return t.attr("d",n)},c=i.selectAll("path").data((function(t){return t.layoutRoot.links()}));c.enter().call((function(t){return t.append("path").attr("fill","none").attr("stroke",g.rS.colors.gray[700]).attr("stroke-width",1.5).call(l),t})),c.call(l),c.exit().remove();var u=t.select(".nodes");u.empty()&&(u=t.append("g").attr("class","nodes"));var s=function(t){t.attr("transform",(function(t){return"translate(".concat(t.x,",").concat(t.y,")")}));var r=t.select("circle");r.empty()&&(r=t.append("circle")),r.attr("fill",g.rS.colors.teal[500]).attr("r",N).style("cursor","pointer").on("click",(function(t,r){return m(r)}));var n=t.select("text");return n.empty()&&(n=t.append("text")),n.attr("fill","black").text((function(t){return t.data.name})).attr("font-family","inherit").attr("text-anchor","middle").attr("dy",21.6).attr("fill","black").attr("font-size",12).attr("transform","rotate(-8)"),t},d=u.selectAll(".actor-node").data((function(t){return t.layoutRoot.descendants()}));d.exit().remove(),d.enter().call((function(t){return t.append("g").attr("class","actor-node").call(s)})),d.call(s)},l=r.select(".actors").selectAll(".actor").data(R);l.enter().call((function(t){return t.append("g").attr("class","actor").call(i)})),l.call(i),l.exit().remove();var c=r.select(".actor-links").selectAll(".actor-link").data(q),u=s.FdL,d=s.jvg().curve(u).x((function(t){return t.x})).y((function(t){return t.y})),f=function(t){return t.attr("d",(function(t){var r=t.points;return d(r)})).attr("fill","none").attr("stroke-width",(function(t){return e(t.source)||e(t.target)?2:1})).attr("stroke",(function(t){return e(t.source)||e(t.target)?g.rS.colors.teal[500]:g.rS.colors.gray[300]}))};c.enter().call((function(t){return t.append("path").attr("class","actor-link").call(f)})),c.call(f),c.exit().remove()}}),[R,q,a,m]),(0,e.jsxs)(x.Fragment,{children:[(0,e.jsxs)(b.u_,{isOpen:l,onClose:d,size:"5xl",children:[(0,e.jsx)(b.ZA,{}),(0,e.jsxs)(b.hz,{children:[(0,e.jsxs)(b.xB,{children:[null===v||void 0===v?void 0:v.operatorId," - ",null===v||void 0===v?void 0:v.name]}),(0,e.jsx)(b.ol,{}),(0,e.jsx)(b.fe,{children:l&&(null===v||void 0===v?void 0:v.node)&&(0,e.jsx)(C,{shouldCollapse:function(t){var r=t.name;return"input"===r||"fields"===r||"streamKey"===r},src:v.node,collapsed:3,name:null,displayDataTypes:!1})}),(0,e.jsx)(b.mz,{children:(0,e.jsx)(u.zx,{colorScheme:"blue",mr:3,onClick:d,children:"Close"})})]})]}),(0,e.jsxs)("svg",{ref:o,width:"".concat(Z,"px"),height:"".concat(F,"px"),children:[(0,e.jsx)("g",{className:"actor-links"}),(0,e.jsx)("g",{className:"actors"})]})]})}var Z=n(5330),F=n(52783),q=n(16640);function R(t){var r=t.actors[0],n=function(t){var r;return{name:(null===(r=t.nodeBody)||void 0===r?void 0:r.$case.toString())||"unknown",children:(t.input||[]).map(n),operatorId:t.operatorId,node:t}},e="noDispatcher";r.dispatcher.length>1?e="multipleDispatchers":1===r.dispatcher.length&&(e="".concat((0,f.toLower)(r.dispatcher[0].type),"Dispatcher"));var a=t.actors.reduce((function(t,r){return t[r.actorId]=r.dispatcher,t}),{});return s.bT9({name:e,extraInfo:"Actor ".concat(t.actors.map((function(t){return t.actorId})).join(", ")),children:r.nodes?[n(r.nodes)]:[],operatorId:"dispatcher",node:a})}function Y(){var t,r,n,s=(0,F.Z)(q.gG).response,f=(0,F.Z)(q.jV).response,h=(0,x.useState)(),g=h[0],y=h[1],w=(0,p.useRouter)(),j=(0,x.useCallback)((function(){if(f&&w.query.id){var t=parseInt(w.query.id),r=f.find((function(r){return r.tableId===t}));if(r){var n=function(t){var r=function(r){var a=t.fragments[r],o=new Set,i=!0,l=!1,c=void 0;try{for(var u,s=a.actors[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var d=u.value,f=!0,h=!1,v=void 0;try{for(var p,x=d.upstreamActorId[Symbol.iterator]();!(f=(p=x.next()).done);f=!0){var g=p.value,m=e.get(g);m&&o.add(m)}}catch(y){h=!0,v=y}finally{try{f||null==x.return||x.return()}finally{if(h)throw v}}}}catch(y){l=!0,c=y}finally{try{i||null==s.return||s.return()}finally{if(l)throw c}}n.push({id:a.fragmentId.toString(),name:"Fragment ".concat(a.fragmentId),parentIds:Array.from(o).map((function(t){return t.toString()})),width:0,height:0,order:a.fragmentId,fragment:a})},n=[],e=new Map;for(var a in t.fragments){var o=t.fragments[a],i=!0,l=!1,c=void 0;try{for(var u,s=o.actors[Symbol.iterator]();!(i=(u=s.next()).done);i=!0){var d=u.value;e.set(d.actorId,d.fragmentId)}}catch(h){l=!0,c=h}finally{try{i||null==s.return||s.return()}finally{if(l)throw c}}}for(var f in t.fragments)r(f);return n}(r);return{fragments:r,fragmentDep:n,fragmentDepDag:(0,d.lu)()(n)}}}}),[f,w.query.id]);(0,x.useEffect)((function(){return s&&(w.query.id||s.length>0&&w.replace("?id=".concat(s[0].id))),function(){}}),[w,w.query.id,s]);var I=null===(t=j())||void 0===t?void 0:t.fragmentDep,b=null===(r=j())||void 0===r?void 0:r.fragmentDepDag,k=null===(n=j())||void 0===n?void 0:n.fragments,S=(0,x.useCallback)((function(){var t=null===k||void 0===k?void 0:k.fragments;if(t){var r=new Map;for(var n in t){var e=R(t[n]);r.set(n,e)}return r}}),[null===k||void 0===k?void 0:k.fragments]),C=S(),D=(0,x.useCallback)((function(){var t=w.query.id;if(t&&s)return s.find((function(r){return r.id==parseInt(t)}))}),[s,w.query.id])(),_=(0,x.useState)(""),N=_[0],A=_[1],z=(0,x.useState)(""),Y=z[0],G=z[1],L=function(t){return w.replace("?id=".concat(t))},M=(0,a.pm)(),O=(0,e.jsxs)(o.kC,{p:3,height:"calc(100vh - 20px)",flexDirection:"column",children:[(0,e.jsx)(Z.Z,{children:"Streaming Plan"}),(0,e.jsxs)(o.kC,{flexDirection:"row",height:"full",width:"full",children:[(0,e.jsxs)(o.gC,{mr:3,spacing:3,alignItems:"flex-start",width:200,height:"full",children:[(0,e.jsxs)(i.NI,{children:[(0,e.jsx)(i.lX,{children:"Relations"}),(0,e.jsx)(l.II,{list:"relationList",spellCheck:!1,onChange:function(t){var r,n=null===(r=null===s||void 0===s?void 0:s.find((function(r){return r.name==t.target.value})))||void 0===r?void 0:r.id;n&&L(n)},placeholder:"Search...",mb:2}),(0,e.jsx)("datalist",{id:"relationList",children:s&&s.map((function(t){return(0,e.jsxs)("option",{value:t.name,children:["(",t.id,") ",t.name]},t.id)}))}),(0,e.jsx)(c.Ph,{value:w.query.id,onChange:function(t){return L(parseInt(t.target.value))},children:s&&s.map((function(t){return(0,e.jsxs)("option",{value:t.id,children:["(",t.id,") ",t.name]},t.name)}))})]}),(0,e.jsxs)(i.NI,{children:[(0,e.jsx)(i.lX,{children:"Goto"}),(0,e.jsxs)(o.gC,{spacing:2,children:[(0,e.jsxs)(o.Ug,{children:[(0,e.jsx)(l.II,{placeholder:"Fragment Id",value:Y,onChange:function(t){return G(t.target.value)}}),(0,e.jsx)(u.zx,{onClick:function(t){return function(){var t=parseInt(Y);if(f){var r=!0,n=!1,e=void 0;try{for(var a,o=f[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var i=a.value;for(var l in i.fragments)if(i.fragments[l].fragmentId==t)return L(i.tableId),void y(t)}}catch(c){n=!0,e=c}finally{try{r||null==o.return||o.return()}finally{if(n)throw e}}}M({title:"Fragment not found",description:"",status:"error",duration:5e3,isClosable:!0})}()},children:"Go"})]}),(0,e.jsxs)(o.Ug,{children:[(0,e.jsx)(l.II,{placeholder:"Actor Id",value:N,onChange:function(t){return A(t.target.value)}}),(0,e.jsx)(u.zx,{onClick:function(t){return function(){var t=parseInt(N);if(f){var r=!0,n=!1,e=void 0;try{for(var a,o=f[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var i=a.value;for(var l in i.fragments){var c=i.fragments[l],u=!0,s=!1,d=void 0;try{for(var h,v=c.actors[Symbol.iterator]();!(u=(h=v.next()).done);u=!0)if(h.value.actorId==t)return L(i.tableId),void y(c.fragmentId)}catch(p){s=!0,d=p}finally{try{u||null==v.return||v.return()}finally{if(s)throw d}}}}}catch(p){n=!0,e=p}finally{try{r||null==o.return||o.return()}finally{if(n)throw e}}}M({title:"Actor not found",description:"",status:"error",duration:5e3,isClosable:!0})}()},children:"Go"})]})]})]}),(0,e.jsxs)(o.kC,{height:"full",width:"full",flexDirection:"column",children:[(0,e.jsx)(o.xv,{fontWeight:"semibold",children:"Plan"}),D&&(0,e.jsxs)(o.xv,{children:[D.id," - ",D.name]}),b&&(0,e.jsx)(o.xu,{flex:"1",overflowY:"scroll",children:(0,e.jsx)(m,{svgWidth:200,mvDependency:b,onSelectedIdChange:function(t){return y(parseInt(t))},selectedId:null===g||void 0===g?void 0:g.toString()})})]})]}),(0,e.jsxs)(o.xu,{flex:1,height:"full",ml:3,overflowX:"scroll",overflowY:"scroll",children:[(0,e.jsx)(o.xv,{fontWeight:"semibold",children:"Fragment Graph"}),C&&I&&(0,e.jsx)(E,{selectedFragmentId:null===g||void 0===g?void 0:g.toString(),fragmentDependency:I,planNodeDependencies:C})]})]})]});return(0,e.jsxs)(x.Fragment,{children:[(0,e.jsx)(v(),{children:(0,e.jsx)("title",{children:"Streaming Fragments"})}),O]})}}},function(t){t.O(0,[662,482,476,894,591,855,136,836,640,293,774,888,179],(function(){return r=64248,t(t.s=r);var r}));var r=t.O();_N_E=r}]);